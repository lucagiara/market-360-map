<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>360 Viewer</title>

  <!-- Pannellum 360 viewer -->
  <link rel="stylesheet" href="https://unpkg.com/pannellum@2.5.6/build/pannellum.css"/>
  <script src="https://unpkg.com/pannellum@2.5.6/build/pannellum.js"></script>

  <style>
    html, body { height: 100%; margin: 0; background: #000; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #topbar {
      position: fixed; top: 0; left: 0; right: 0; height: 44px;
      display:flex; align-items:center; gap:12px;
      padding: 0 12px; background: rgba(0,0,0,0.75); color:#fff; z-index: 10;
    }
    #viewer { position: absolute; top: 44px; left: 0; right: 0; bottom: 0; }
    a { color: #8ab4f8; text-decoration: none; }
    a:hover { text-decoration: underline; }
    #msg {
      position: fixed; left: 12px; bottom: 12px;
      color:#fff; background: rgba(0,0,0,0.6);
      padding:10px 12px; border-radius: 10px; max-width: 520px;
    }
    code { color:#ddd; }
  </style>
</head>
<body>
  <div id="topbar">
    <strong id="t">360 Viewer</strong>
    <a id="raw" href="#" target="_blank" rel="noopener">Open raw image</a>
    <span style="opacity:.7">| Drag to pan</span>
  </div>

  <div id="viewer"></div>
  <div id="msg" style="display:none"></div>

<script>
  const params = new URLSearchParams(location.search);
  const img = params.get("img");        // e.g. photos/R0010151.JPG
  const title = params.get("title") || "";

  function showMsg(html) {
    const el = document.getElementById("msg");
    el.style.display = "block";
    el.innerHTML = html;
  }

  if (!img) {
    showMsg('Missing <code>?img=...</code>. Example: <code>viewer.html?img=photos/R0010151.JPG</code>');
    throw new Error("Missing img param");
  }

  // Make absolute URL relative to viewer.html
  const abs = new URL(img, location.href).toString();

  if (title) document.getElementById("t").textContent = title;
  document.getElementById("raw").href = abs;

  // Preflight load so we can show a helpful error if it's 404 / missing
  const test = new Image();
  test.onload = () => {
    pannellum.viewer('viewer', {
      type: 'equirectangular',
      panorama: abs,
      autoLoad: true,
      showZoomCtrl: true,
      showFullscreenCtrl: true
    });
  };
  test.onerror = () => {
    showMsg(
      `Could not load image:<br><code>${abs}</code><br><br>
      Most common causes:<br>
      • The file is NOT actually in <code>/photos/</code> in your repo<br>
      • The URL has different case/extension (JPG vs jpg) — GitHub is case-sensitive<br>
      • GitHub Pages hasn’t finished deploying yet (wait 1–3 minutes + refresh)<br><br>
      Try clicking “Open raw image” above.`
    );
  };
  test.src = abs;
</script>
</body>
</html>
